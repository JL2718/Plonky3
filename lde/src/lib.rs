//! This crate contains a framework for low-degree tests (LDTs).

#![no_std]

mod naive;

pub use naive::*;

extern crate alloc;

use p3_field::{FieldExtension, TwoAdicField};
use p3_matrix::dense::RowMajorMatrix;

pub trait TwoAdicSubgroupLDE<FE: FieldExtension>
where
    FE::Extension: TwoAdicField,
{
    /// The result type. Typically this will be `FE`, but it may also be a compressed encoding of
    /// the subspace of `FE` that may be produced by LDEs.
    type Res: Into<FE::Extension>;

    /// Given a batch of polynomials, each defined by `2^k` evaluations over the subgroup generated
    /// by `FE::primitive_root_of_unity(k)`, compute their evaluations over the subgroup generated
    /// by `FE::primitive_root_of_unity(k + added_bits)`.
    fn subgroup_lde_batch(
        &self,
        polys: RowMajorMatrix<FE::Base>,
        added_bits: usize,
    ) -> RowMajorMatrix<Self::Res>;
}

pub trait TwoAdicCosetLDE<FE: FieldExtension>
where
    FE::Extension: TwoAdicField,
{
    /// The result type. Typically this will be `FE`, but it may also be a compressed encoding of
    /// the subspace of `FE` that may be produced by LDEs.
    type Res: Into<FE::Extension>;

    fn shift(&self, lde_bits: usize) -> FE::Extension;

    /// Given a batch of polynomials, each defined by `2^k` evaluations over the subgroup generated
    /// by `FE::primitive_root_of_unity(k)`, compute their evaluations over the coset `shift H`,
    /// where `H` is the subgroup generated by `FE::primitive_root_of_unity(k + added_bits)`.
    fn coset_lde_batch(
        &self,
        polys: RowMajorMatrix<FE::Base>,
        added_bits: usize,
    ) -> RowMajorMatrix<Self::Res>;
}
